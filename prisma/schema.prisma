generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Workspace {
  id          String  @id @default(cuid())
  name        String
  slug        String  @unique
  description String?

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  simulations Simulation[]

  @@map("workspaces")
}

enum DataSource {
  DATABRICKS
  SIMULATION
}

enum SimulationStatus {
  DRAFT
  PENDING
  RUNNING
  COMPLETED
  ERROR
}

enum Type {
  CSAT
}

// CSAT = ticker / totalOrders

model Simulation {
  id          String     @id @default(cuid())
  name        String
  description String?
  dataSource  DataSource @default(DATABRICKS) @map("data_source")

  type Type

  startDate DateTime @map("start_date")
  endDate   DateTime @map("end_date")

  workspace   Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId String    @map("workspace_id")

  operator             String?
  operatorNumber       Int?     @map("operator_number")
  operatorIsPercentage Boolean? @map("operator_is_percentage")

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  @@map("simulations")
}

model Execution {
  id      String           @id @default(cuid())
  status  SimulationStatus @default(PENDING)
  error   String?
  current Boolean?         @default(true)

  filters Json?

  ifoodDelivery Boolean? @map("ifood_felivery")

  values Json?

  executionTimeInSeconds Int? @map("execution_time_in_seconds")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("executions")
}
